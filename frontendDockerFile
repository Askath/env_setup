# Use official node image as the base image
FROM node:18.18.2 AS build

# Set the working directory
WORKDIR /app

# Adding Certificate
ADD ./optadata-gruppe-ODA-DC1-CA.crt /usr/local/share/ca-certificates/
USER root
RUN update-ca-certificates

# Configurate node to use the certificate
ENV NODE_EXTRA_CA_CERTS=/usr/local/share/ca-certificates/optadata-gruppe-ODA-DC1-CA.crt
ENV CYPRESS_DOWNLOAD_USE_CA=1

# COPY npm config
COPY ./npmrc_docker /root/.npmrc
ENV NPM_TOKEN=dC5kcnVmZmVsOld2RFplOWJMZl9DZW02MzZ0WWhA

# Install Angular CLI globally
RUN npm install -g @angular/cli

# Copy package.json and install dependencies
COPY package.json .
RUN npm install

# Copy the rest of the application code
COPY . .

# Expose port 4200
EXPOSE 4200

# Start the Angular development server
CMD ng serve --configuration development --host 0.0.0.0 --poll
